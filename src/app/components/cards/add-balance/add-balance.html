<div class="add-balance-container">
  <div class="header">
    <button class="back-button" (click)="goBack()">
      <i class="fas fa-arrow-left"></i>
      <span>Geri Dön</span>
    </button>
    <h2>Bakiye Yükle</h2>
  </div>

  <div class="loading" *ngIf="loading">
    <i class="fas fa-spinner fa-spin"></i>
    <span>Yükleniyor...</span>
  </div>

  <div class="error-message" *ngIf="error">
    <i class="fas fa-exclamation-circle"></i>
    <span>{{ error }}</span>
  </div>

  <div class="success-message" *ngIf="success">
    <i class="fas fa-check-circle"></i>
    <span>{{ success }}</span>
  </div>

  <!-- Kart yoksa Kart Ekle butonu göster -->
  <div class="no-cards-container" *ngIf="!loading && cards.length === 0">
    <div class="no-cards-message">
      <i class="fas fa-credit-card"></i>
      <h3>Henüz kartınız bulunmuyor</h3>
      <p>Bakiye yüklemek için önce bir kart eklemeniz gerekiyor.</p>
      <button class="add-card-button" (click)="goToAddCard()">
        <i class="fas fa-plus"></i>
        Kart Ekle
      </button>
    </div>
  </div>

  <form [formGroup]="balanceForm" (ngSubmit)="onSubmit()" class="balance-form" *ngIf="!loading && cards.length > 0">
    <div class="form-section">
      <label>Kart Seçin</label>
      <div class="cards-list">
        <div *ngFor="let card of cards" 
             class="card-option" 
             [class.selected]="balanceForm.get('cardId')?.value === card.cardId"
             (click)="balanceForm.get('cardId')?.setValue(card.cardId)">
          <div class="card-info">
            <div class="card-number">
              <i class="fas fa-credit-card"></i>
              <span>{{ formatCardNumber(card.cardNo) }}</span>
            </div>
            <div class="card-details">
              <span class="name">{{ card.nameOnCard }}</span>
              <span class="valid">{{ card.validDate }}</span>
            </div>
          </div>
          <div class="card-balance">
            Mevcut Bakiye: <span>{{ card.balance | number:'1.2-2' }} ₺</span>
          </div>
        </div>
      </div>
      <div class="error-text" *ngIf="balanceForm.get('cardId')?.touched && balanceForm.get('cardId')?.invalid">
        Lütfen bir kart seçin
      </div>
    </div>

    <div class="form-section">
      <label for="balance">Yüklenecek Tutar</label>
      <div class="balance-input">
        <input type="text" 
               id="balance" 
               placeholder="0"
               (input)="onBalanceInput($event)"
               (focus)="onBalanceFocus($event)"
               (blur)="onBalanceBlur($event)">
        <span class="currency">₺</span>
      </div>
      <div class="error-text" *ngIf="balanceForm.get('balance')?.touched && balanceForm.get('balance')?.errors">
        <span *ngIf="balanceForm.get('balance')?.errors?.['required']">Lütfen yüklenecek tutarı girin</span>
        <span *ngIf="balanceForm.get('balance')?.errors?.['min']">Yüklenecek bakiye 0'dan büyük olmalıdır.</span>
        <span *ngIf="balanceForm.get('balance')?.errors?.['max']">Yüklenecek bakiye en fazla 1.000.000 TL olabilir.</span>
      </div>
    </div>

    <div class="form-section">
      <label for="category">Gelir Kategorisi</label>
      <select id="category" formControlName="category" class="category-select">
        <option *ngFor="let option of categoryOptions" [value]="option.value">
          {{ option.label }}
        </option>
      </select>
      <div class="error-text" *ngIf="balanceForm.get('category')?.touched && balanceForm.get('category')?.invalid">
        Lütfen bir kategori seçin
      </div>
    </div>

    <div class="form-section">
      <label for="name">Açıklama (İsteğe Bağlı)</label>
      <input type="text" 
             id="name" 
             formControlName="name" 
             placeholder="Örn: Ocak maaşı, Freelance proje ödemesi..."
             maxlength="30">
      <div class="error-text" *ngIf="balanceForm.get('name')?.touched && balanceForm.get('name')?.errors">
        <span *ngIf="balanceForm.get('name')?.errors?.['minlength']">Açıklama en az 3 karakter olmalıdır</span>
        <span *ngIf="balanceForm.get('name')?.errors?.['maxlength']">Açıklama en fazla 30 karakter olabilir</span>
      </div>
      <div class="help-text">
        Boş bırakılırsa "Para Yükleme" olarak kaydedilir
      </div>
    </div>

    <button type="submit" 
            class="submit-button" 
            [disabled]="balanceForm.invalid || loading">
      <i class="fas fa-plus-circle"></i>
      Bakiye Yükle
    </button>
  </form>
</div> 